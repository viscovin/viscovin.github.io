---
layout: post
title: Week 7
---
# Web Security

### Web as a Delivery Mechanism

Mosaic: one of the first browsers to be used (1993)  
Some of the attacks we learn about today may not work today. Things evolve very fast and 95% of malware is delivered via the web.

<img src= "https://raw.githubusercontent.com/viscovin/viscovin.github.io/master/images/evolution.JPG">

**Injection Points**
- HTTP: HTTP Proxy Network Layer 
- HTML (Raw HTML): WinInet ETW/ETL
- HTML (DOM Tree): Browser/Extensions
- Javascript: Script Engine
- De-Obfuscated Content: Browser/Extensions

### User Level Attacks
**- Social Engineering:** In the context of information security, refers to psychological manipulation of people into performing actions or divulging confidential information. A type of confidence trick for the purpose of information gathering, fraud, or system access, it differs from a traditional "con" in that it is often one of many steps in a more complex fraud scheme.

**Users ARE the weak link**
- Hardened/current browser/OS will not help.
- Exploit common user traits
    - Impatient
    - Lazy
    - Self-proclaimed omniscience
    - Clickaholic
**Direct the user to malicious content through their own actions**
- Executables
- Browser exploits
- Malicious forms

#### Phishing
- Not just restricted to banking/financial anymore
- URLs not always delivered via email.
- Spear phishing, social media, and snowshoe spam continues to keep it alive.
- Valid SSL cert does not always protect the user.
- Sites are very short-lived

#### SEO Poisoning
- Identify trends using available tools such as Google Trends
- Use search results to lure the web-searching victim.
    - Celebrities
    - Pop Culture
    - World Events
    - Educational/Professional
    - Fake AV/AM
- Game the search engine’s relevance rules
    - Related content
    - Massive inbound linking
    - Relevant inbound linking
- Site redirects to malicious content

#### Fake Updates & Fake Antivirus
- Preys on user’s good intentions.
- Often mimics OS-level UI components.
- Sometimes mimics well-known security brands.
- May deliver malware
- May deliver absolutely nothing for the low cost of $49.99. If you act now.

#### WYSIWYG (What You See is What You Get)
- URL Obfuscation makes suspicious URLs look legitimate
    - URL shortening services
    - Homographic attacks
        - ASCII – http://www.rnicrosoft.com/en-us/download/
        - ASCII – http://www.arnazon.com/prime/
        - ASCII – http://I92.I68.0.I
        - ASCII – http://oregonstate.ecIu
- IDN – http://paypаl.com (internationalized domain name)
    - (http://xn--paypl-7ve.com)

#### Social Media Attacks
- Social media: A gift to malware authors
    - Anti-spam systems have become very effective.
    - Social media opens a new world for malicious URL delivery and information gathering

I saw the link on the Facebook and Twitter,so it must be OK, right?
Have you Google or Facebook searched your lecturers?
Who ever heard of “Robin Sage”?
Who has already been Catfished?

#### Malvertising
- Malicious actor uses advertising networks as delivery mechanism for malware.
- Does not require any web site or hosting provider compromise.
- Very dangerous, as most end users implicitly trust content on high-profile, popular, and known sites.

<img src= "https://raw.githubusercontent.com/viscovin/viscovin.github.io/master/images/malvertising.JPG">

#### Waterhole Attack
- With closed OSes and application signing, developers have become a prime target
- An easy way to target developers is to hack a resource (forum for example) known to be used by a community of developers

### Common Defenses for User Attacks
- URL/Domain Reputation Systems
    - Real-time protection in browser or network device.
    - Search result link annotation
- Site Certification Services
- Client and Gateway AV/AM
- Safe URL Shorteners
- Content provider education
    - Banks love to train their customers to be phishing victims.
    - Brand monitoring services
- End user education

### Browser Level Attacks
#### Security Features of Modern Web Browsers
- Content Security Policy Enforcement
    - Same Origin Policy (SOP)
        - DOM
        - XMLHTTPRequest
        - Cookies
        - Flash
        - Java
    - Cross Origin Resource Sharing (CORS)
- URL Scheme Access Rules
- OS Isolation/Sandboxing
- Redirection Restrictions
- Content handling/sniffing
- Disruptive Script Handling
- Built-in and Plug-in URL Reputation Client
- Add-on AV/AM Content Monitoring

**The Browser Exploit**
- Browser downloads, renders and executes maliciously crafted web content.
- Exploits vulnerabilities in the browser
    - Known
    - Unknown, AKA “Zero Day”
    - Often executes shellcode via the browser script engine.
- Typically a multi-step process
    - Lure user to site
        - User-initiated
        - Drive-by
    - Exploit browser
    - Download/Execute actual payload
        - Payload can be any malware, does not need to be web-centric.

**Content/Script Obfuscation**
- Can’t we just filter malicious-looking page content?
    - Use advanced text processing
    - Browser plugin or proxy server
    - Block content we deem malicious.
- Malware Obfuscation Techniques
    - Rename script variables to meaningless, short, difficult to read text.
    - Remove any whitespace, make a massive block of text
    - Self-generating code. Must be executed to create ‘itself’, which is then executed.
    - Heavy use of eval statement with character codes, string manipulation
    - Various encryption methods

**Man in the Middle**
- Intercept and modify traffic in real-time
- Requires ability for mid-traffic insertion
    - DNS poisoning
    - Wifi Hacking
    - ARP Attack
    - Rogue or infected Router
    - Rogue Proxy
- HTTP, a text-based transport protocol
    - Very easy to intercept – (HTTP)
    - Sort of easy to intercept (HTTPS)
    - Rewrite content in-line
        - Proxy-level
        - Packet-level

**Man in the Browser**
- MegaCorp is the most secure company in the world.
    - Firewalls, gateway devices, LANs, and WAN links – all rock solid and airtight.
    - How does the criminal hacker get a toehold?
    - Answer!! Bob in accounting likes to watch cat videos at home, while doing work via the corporate VPN.
- Dangerous cousin to the MITM attack
     - Intercept and modify traffic to/from the server, but INSIDE THE BROWSER
        - Example: Change financial account numbers mid-stream, during a funds transfer.
        - Example: Sniff and steal passwords
        - Example: Port-scan web-users internal network
- Methods
    - Browser exploit
    - Plug-in exploit 
    - New HTML5 features such as web sockets and web workers.

**DNS Spoofing**
- Which do you use?
    - http://1.2.3.4/onlinebanking/login.html
    - http://banking.example/onlinebanking/login.html
- DNS Spoofing
    - AKA “DNS Cache Poisoning”
    - Browser asks for legit domain
    - ISP DNS server returns malicious IP, since it has poison cache
    - Browser fetches content from malicious IP using correct host in HTTP header.
- Uses
    - Phishing
    - Exploits
    
**Clickjacking AKA UI Redressing**
- Tricks the user into clicking a pre-determined link in a rendered HTML page.
- Use HTML frames and layers to confuse the user.  
- Hides malicious content behind legitimate content
    - Facebook like button 
    - Re-tweet button
- Not just for clicks anymore!
    - Can also be used for text input (i.e. passwords, personal information)

**SQL Injection**
What is it?

<img src= "https://raw.githubusercontent.com/viscovin/viscovin.github.io/master/images/sql.JPG">

- Implications
    - Circumvent authentication/authorization
    - Reveal private data

*There are many flavors of SQL Injection*
- Error driven SQL injection
- Numeric or string
- SQL statement injection
- UDF (User Defined Function) injection
- Blind
    - Timer based
    - Condition based
    
*Not limited to DATA*
- Most SQL server offer mechanisms for bulk import/export from files AKA file system access
- Many provide mechanisms to  query remote databases AKA exfiltration
- Some SQL server even provide the ability to execute shell cmds AKA execution

**Same Origin Policy Attacks**
- Core security feature in all browsers, although not standardized.
- “Resource from an origin may only access the same origin”
- What is an origin?
    - Keyed by scheme, host, and port of a URL.  A ‘site identifier’
    - https://foo.com/ is a different origin than http://foo.com/	
    - http://bar.com is the same origin as http://bar.com/pages/page1.html
- What does it control?
    - DOM Access between scripts running in the browser.
    - XMLHttpRequest (XHR) requests
    - Cookie access
    - Plugin access
- Rules are meant to be broken (otherwise the Internet is very boring)
    - Image, Linking, Forms, Script sourcing
    - CORS (Cross Origin Resource Sharing)

**Cross-site Scripting (XSS)**
Goal: Inject client-side script into other user's browsers(Bypassing SOP)
- Why?
    - Bypass SOP rules and allow for script execution
    - Once my script executes in another user’s browser, I can do many things.
- How?
    - A form of CODE INJECTION
    - Exploit a user’s trust in a site.     
        - “I go to http://catforums.com every day, I know it is safe!”
        - Malicious actor posts to http://catforums.com, and embeds script in the submission data.
        - Submission data (i.e. comment posting) is accessed/displayed back to me, INCLUDING THE SCRIPT and/or MALICIOUS CONTENT.
- Types
    - Persistent, more dangerous
    - Non-persistent, more common

