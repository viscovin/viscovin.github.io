---
layout: post
title: Week 3
published: true
---
# Malware Defense

**First Contact**
- Email
- Instant Messaging
- Social Engineering, Social Networks
- Malvertising
- Watering Holes 
- Poisoned Search Results
- Physical Access

**Local Execution**
- Social Engineering: user knowingly runs an executable (Copy cat apps) 
- Abusing features: USB Autorun, physcial access
- Browser based exploits: Scripts, pdf, java
- Redirects

**Establish Presence**

*Blend in or Hide*
* Appear Legitimate
    - OS like filenames or wrong path
    - Change Creation/Modification
    - Signed
* Hide 
    - Bootkit
    - Rootkit

*Persist*
- System startup (bootkit)
- Windows Startup (Services, AppINIT, Winlogon, Run keys, Startup folder) 
- Aplication startup (DLL hijacking, parasitic, shell extension handler
- Other such as scheduled tasks, autorun.inf

**Malicious Activity**

*Harvest Information*
- Enumerate (Docs, Passwords, Email, Processes)
- Hook (Browser, Keylog, Screen Scrap)
- Parse (Passwords, Credit Cards)
- Log

*Phone Home* (Getting information from compromised machine) 
- Web (http, https, ftp, Tor)
- Email

## Popular Defense Technologies
- Anti-Malware
- Access Control
- Host IPS
- Host Firewall
- Web Reputation
- Network Reputation
- Message Reputation
- Network Instrusion Prevention
- Network Firewall

### Anti-Malware Features
- Traditional File Scanning (OAS, ODS)
- Registry & Cookies
- Cloud scanning
- Memory Scanning
- Scripts
- Heuristics
- Decomposition
- Configuration: Exclusions, Sensitivity, Reporting

### YARA (Pattern matching swiss knife for malware researchers)
- Strings expressed as “mystring”, can be followed by
    * nocase – case insensitive
    * wide – strip zeroes in unicode strings
    * wide ascii – searches both wide and ascii strings
    * fullword – only considers full delimited strings, not substrings
- Byte patterns (aka Hexadecimal strings) as {4D 5A 90 00}
    * Accepts “?” and “??” wildcards { E2 34 ?? C8 A? FB }
    * “Jumps” to denote a number of wildcards { E2 34 [3-4] FB }
    * OR Fragements { E2 34 (23 C8 | 24 C8 25) FB }
- Conditions can include boolean operators (and, or, not), relational (>=, <=, <, >, ==, !=), arithmetic (+,-,*,\), and bitwise (&, |, <<, >>, ~)
    * ($a or $b)
    * #a == 6 and #b > 10
    * $a at 100 and $b at 200 (at virtual address)

## Lab: Yara
**Some Rules of Thumb for Creating Yara Rules**
- Analyze sample groups to write yara rules.
- Use tools to help with analysis (HIEW and/or FileInsight)
- You’re looking for unusual commonalities across all samples in the group
- Pay attention to string types (ascii vs wide)
- Good generic rules have fewer strings and conditions

**Example Template Provided by Craig Schmugar**

<img src= "https://raw.githubusercontent.com/viscovin/viscovin.github.io/master/images/Template.JPG">

We were given a series of sample files (Sample Group 1) to analyze with FileInsight and create a Yara rule that would match all the files in the folder Sytro but none of the file in C:\windows\system32

**FileInsight** 

<img src= "https://raw.githubusercontent.com/viscovin/viscovin.github.io/master/images/Insight.JPG">

**The rule I came up with after string analysis**

<img src= "https://raw.githubusercontent.com/viscovin/viscovin.github.io/master/images/Myrule.JPG">

**Matched 6 of the 7 files in Sytro file**

<img src= "https://raw.githubusercontent.com/viscovin/viscovin.github.io/master/images/YaraMatches.JPG">





















